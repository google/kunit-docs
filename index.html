<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KUnit &mdash; KUnit  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Using KUnit" href="usage/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="#" class="icon icon-home"> KUnit
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="usage/index.html">Using KUnit</a></li>
<li class="toctree-l1"><a class="reference internal" href="development/index.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="third_party/kernel/index.html">Upstream Version</a></li>
<li class="toctree-l1"><a class="reference internal" href="third_party/stable_kernel/index.html">Deprecated Version (“kunit/alpha/master”)</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="mocking.html">Fakes and Stubbing and Mocks, Oh My!</a></li>
<li class="toctree-l1"><a class="reference internal" href="press.html">Press</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">KUnit</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="#" class="icon icon-home"></a> &raquo;</li>
      <li>KUnit</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="kunit">
<h1>KUnit<a class="headerlink" href="#kunit" title="Permalink to this headline"></a></h1>
<div class="toctree-wrapper compound">
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="usage/index.html">Using KUnit</a><ul>
<li class="toctree-l2"><a class="reference internal" href="usage/getting_kunit.html">Getting KUnit</a></li>
<li class="toctree-l2"><a class="reference internal" href="usage/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l2"><a class="reference internal" href="usage/index.html#running-tests">Running tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="usage/index.html#writing-tests">Writing tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="usage/index.html#submitting-tests-upstream">Submitting tests upstream</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="development/index.html">Development</a><ul>
<li class="toctree-l2"><a class="reference internal" href="development/start.html">Getting Started Developing KUnit</a></li>
<li class="toctree-l2"><a class="reference internal" href="development/design.html">KUnit Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="development/useful-commands.html">Useful Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="development/prow.html">Prow Presubmit for KUnit Gerrit</a></li>
<li class="toctree-l2"><a class="reference internal" href="development/start_internal.html">Getting Started Contributing to non-kernel KUnit repos</a></li>
<li class="toctree-l2"><a class="reference internal" href="development/gerrit-workflow.html">Gerrit Workflow</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="third_party/kernel/index.html">Upstream Version</a><ul>
<li class="toctree-l2"><a class="reference internal" href="third_party/kernel/index.html#where-to-get-the-code">Where to get the code</a></li>
<li class="toctree-l2"><a class="reference internal" href="third_party/kernel/index.html#getting-started-guide">Getting Started Guide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="third_party/stable_kernel/index.html">Deprecated Version (“kunit/alpha/master”)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="third_party/stable_kernel/index.html#where-to-get-the-code">Where to get the code</a></li>
<li class="toctree-l2"><a class="reference internal" href="third_party/stable_kernel/index.html#getting-started-guide">Getting Started Guide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Release Notes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="release_notes.html#v5-5">5.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_notes.html#v5-6">5.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_notes.html#v5-7">5.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_notes.html#v5-8">5.8</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_notes.html#v5-9">5.9</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_notes.html#v5-10">5.10</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_notes.html#v5-11">5.11</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_notes.html#v5-12">5.12</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_notes.html#v5-13">5.13</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_notes.html#v5-14">5.14</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_notes.html#v5-15">5.15</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_notes.html#v5-16">5.16</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_notes.html#v5-17">5.17</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_notes.html#v5-18">5.18</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_notes.html#v5-19">5.19</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_notes.html#tentative">6.0 (tentative)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="mocking.html">Fakes and Stubbing and Mocks, Oh My!</a><ul>
<li class="toctree-l2"><a class="reference internal" href="mocking.html#why-do-we-need-this">Why do we need this?</a></li>
<li class="toctree-l2"><a class="reference internal" href="mocking.html#fakes-versus-mocks">Fakes versus mocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="mocking.html#function-redirection">Function redirection</a></li>
<li class="toctree-l2"><a class="reference internal" href="mocking.html#storing-and-accessing-state-for-fakes-mocks">Storing and accessing state for fakes/mocks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="press.html">Press</a><ul>
<li class="toctree-l2"><a class="reference internal" href="press.html#talks-about-kunit">Talks about KUnit</a></li>
<li class="toctree-l2"><a class="reference internal" href="press.html#articles-about-kunit">Articles about KUnit</a></li>
</ul>
</li>
</ul>
</div>
<section id="what-is-kunit">
<h2>What is KUnit?<a class="headerlink" href="#what-is-kunit" title="Permalink to this headline"></a></h2>
<p>KUnit is a lightweight unit testing framework for the Linux kernel.
These tests are able to be run locally on a developer’s workstation without a
VM or special hardware.</p>
<p>KUnit is heavily inspired by JUnit, Python’s unittest.mock, and
Googletest/Googlemock for C++. KUnit provides facilities for defining unit test
cases, grouping related test cases into test suites, providing common
infrastructure for running tests, and more.</p>
<p>Get started now: <a class="reference internal" href="usage/index.html"><span class="doc">Using KUnit</span></a></p>
</section>
<section id="who-is-it-for">
<h2>Who is it for?<a class="headerlink" href="#who-is-it-for" title="Permalink to this headline"></a></h2>
<p>If you work on the Linux kernel, then KUnit is for you.</p>
</section>
<section id="why-unit-test-the-kernel">
<h2>Why unit test the kernel?<a class="headerlink" href="#why-unit-test-the-kernel" title="Permalink to this headline"></a></h2>
<p>The first question is, “why write unit tests in the first place?”</p>
<p>A unit test is a test focused on testing a small “unit” of code. This is
usually on the level of a few functions at most. Unit tests try to avoid
external dependencies like hardware and/or stub them out where possible.</p>
<p>This ideally makes unit tests more stable, faster, and easier to debug when
they fail.</p>
<section id="in-kernel-testing">
<h3>In-kernel testing<a class="headerlink" href="#in-kernel-testing" title="Permalink to this headline"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In our case, “unit test” implies in-kernel test code. It’s not really possible
to be a “unit test” if you’re relying on a kernel working enough to have a
functional userspace on top of it.</p>
</div>
<p>For internal libraries (e.g. <code class="docutils literal notranslate"><span class="pre">include/linux/list.h</span></code>), there’s no good way to
test from userspace. It’s <em>far</em> easier to write in-kernel code to test these.
That are some tests that make this work, but if you’re starting from scratch,
just use KUnit.</p>
<p>For code with a user facing component, you’ll want some tests in userspace.
But it can be useful to have unit tests as well. For example, it can be hard to
trigger certain code paths from userspace, particularly error paths.
Furthermore, it’s probably much faster and more hermetic to build and run the
tests under KUnit instead of booting a machine and waiting for all the needed
userspace processes to come up.</p>
</section>
</section>
<section id="why-kunit">
<h2>Why KUnit?<a class="headerlink" href="#why-kunit" title="Permalink to this headline"></a></h2>
<p>KUnit provides a library to help making writing tests easy: including making
assertions, setting up and cleaning up test resources, and more.
It also provides a <a class="reference external" href="third_party/kernel/docs/kunit-tool.html">python script</a>
to make building and running tests easy.</p>
<p>kselftest has a way of writing unit tests as kernel modules via the helpers in
<code class="docutils literal notranslate"><span class="pre">tools/testing/selftests/kselftest_module.h</span></code>. But this requires more
boilerplate scattered across several files and potentially several directories.</p>
<section id="uml">
<h3>UML<a class="headerlink" href="#uml" title="Permalink to this headline"></a></h3>
<p>KUnit is able to run tests without needing a
virtual machine or actual hardware with User Mode Linux. User Mode Linux is a
Linux architecture, like ARM or x86; however, unlike other architectures it
compiles to a standalone program that can be run like any other program
directly inside of a host operating system; to be clear, it does not require
any virtualization support; it is just a regular program. User Mode Linux is
fast: on my desktop it boots to init process in under a second.</p>
<p>The provided tooling (<code class="docutils literal notranslate"><span class="pre">tools/testing/kunit/kunit.py</span></code>) mainly works with UML,
but you can use KUnit manually on different architectures, if wanted. See <a class="reference external" href="third_party/kernel/docs/start.html">here</a> for more details.</p>
</section>
</section>
<section id="how-do-i-use-it">
<h2>How do I use it?<a class="headerlink" href="#how-do-i-use-it" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="usage/index.html"><span class="doc">Using KUnit</span></a> - for new users of KUnit</p></li>
<li><p>For upstream KUnit:
- <a class="reference external" href="third_party/kernel/docs/usage.html">Usage</a> - for a more detailed explanation of KUnit features
- <a class="reference external" href="third_party/kernel/docs/api">API</a> - for the list of KUnit APIs used for testing</p></li>
</ul>
</section>
<section id="where-do-i-get-it">
<h2>Where do I get it?<a class="headerlink" href="#where-do-i-get-it" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Upstream: <a class="reference external" href="https://www.kernel.org/">https://www.kernel.org/</a> (version 5.5 or later)</p></li>
<li><p>Deprecated version: <a class="reference external" href="https://kunit.googlesource.com/linux/+/kunit/alpha/master">https://kunit.googlesource.com/linux/+/kunit/alpha/master</a></p></li>
</ul>
</section>
<section id="connect-with-us">
<h2>Connect with us<a class="headerlink" href="#connect-with-us" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Mailing List: <a class="reference external" href="mailto:kunit-dev&#37;&#52;&#48;googlegroups&#46;com">kunit-dev<span>&#64;</span>googlegroups<span>&#46;</span>com</a></p></li>
<li><p>Google Groups (web interface for above): <a class="reference external" href="https://groups.google.com/forum/#!forum/kunit-dev">https://groups.google.com/forum/#!forum/kunit-dev</a></p></li>
<li><p>IRC: #kunit on oftc.net</p></li>
<li><p>Riot: <a class="reference external" href="https://riot.im/app/#/room/#_oftc_#kunit:matrix.org">#kunit:matrix.org</a></p></li>
</ul>
</section>
<section id="contributing">
<h2>Contributing<a class="headerlink" href="#contributing" title="Permalink to this headline"></a></h2>
<p>If you want to contribute to KUnit in the Linux kernel (which is just the same
as contributing to the Linux kernel, please see <a class="reference external" href="https://www.kernel.org/doc/html/latest/#introduction-to-kernel-development">the Linux kernel’s guide on
contributing</a>.</p>
<p>For other KUnit repositories (CI/CD, vim plugin, etc), please see
<a class="reference download internal" download="" href="_downloads/6a3371457528722a734f3c51d9238c13/CONTRIBUTING.md"><code class="xref download docutils literal notranslate"><span class="pre">CONTRIBUTING.md</span></code></a>.</p>
<p>In all cases, you will also want to take a look at <a class="reference internal" href="development/index.html"><span class="doc">Development</span></a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="usage/index.html" class="btn btn-neutral float-right" title="Using KUnit" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019 Google LLC.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>