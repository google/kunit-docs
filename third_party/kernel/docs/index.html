

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>KUnit - Unit Testing for the Linux Kernel &mdash; The Linux Kernel  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />

  
  

  
  

  

  
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Getting Started" href="start.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="#" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.13.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="start.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Using KUnit</a></li>
<li class="toctree-l1"><a class="reference internal" href="kunit-tool.html">kunit_tool How-To</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="style.html">Test Style and Nomenclature</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="tips.html">Tips For Writing KUnit Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="running_tips.html">Tips For Running KUnit Tests</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">The Linux Kernel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="#" class="icon icon-home"></a> &raquo;</li>
        
      <li>KUnit - Unit Testing for the Linux Kernel</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="kunit-unit-testing-for-the-linux-kernel">
<h1>KUnit - Unit Testing for the Linux Kernel<a class="headerlink" href="#kunit-unit-testing-for-the-linux-kernel" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="start.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="start.html#installing-dependencies">Installing dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="start.html#running-tests-with-the-kunit-wrapper">Running tests with the KUnit Wrapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="start.html#running-tests-without-the-kunit-wrapper">Running tests without the KUnit Wrapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="start.html#writing-your-first-test">Writing your first test</a></li>
<li class="toctree-l2"><a class="reference internal" href="start.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Using KUnit</a><ul>
<li class="toctree-l2"><a class="reference internal" href="usage.html#organization-of-this-document">Organization of this document</a></li>
<li class="toctree-l2"><a class="reference internal" href="usage.html#testing">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="usage.html#common-patterns">Common Patterns</a></li>
<li class="toctree-l2"><a class="reference internal" href="usage.html#kunit-on-non-uml-architectures">KUnit on non-UML architectures</a></li>
<li class="toctree-l2"><a class="reference internal" href="usage.html#kunit-debugfs-representation">KUnit debugfs representation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="kunit-tool.html">kunit_tool How-To</a><ul>
<li class="toctree-l2"><a class="reference internal" href="kunit-tool.html#what-is-kunit-tool">What is kunit_tool?</a></li>
<li class="toctree-l2"><a class="reference internal" href="kunit-tool.html#what-is-a-kunitconfig">What is a .kunitconfig?</a></li>
<li class="toctree-l2"><a class="reference internal" href="kunit-tool.html#getting-started-with-kunit-tool">Getting Started with kunit_tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="kunit-tool.html#configuring-building-and-running-tests">Configuring, Building, and Running Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="kunit-tool.html#parsing-test-results">Parsing Test Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="kunit-tool.html#filtering-tests">Filtering Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="kunit-tool.html#running-tests-on-qemu">Running Tests on QEMU</a></li>
<li class="toctree-l2"><a class="reference internal" href="kunit-tool.html#other-useful-options">Other Useful Options</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api/index.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api/test.html">Test API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="style.html">Test Style and Nomenclature</a><ul>
<li class="toctree-l2"><a class="reference internal" href="style.html#subsystems-suites-and-tests">Subsystems, Suites, and Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="style.html#test-kconfig-entries">Test Kconfig Entries</a></li>
<li class="toctree-l2"><a class="reference internal" href="style.html#test-file-and-module-names">Test File and Module Names</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-is-this-different-from-autotest-kselftest-etc">How is this different from Autotest, kselftest, etc?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#does-kunit-support-running-on-architectures-other-than-uml">Does KUnit support running on architectures other than UML?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#what-is-the-difference-between-a-unit-test-and-these-other-kinds-of-tests">What is the difference between a unit test and these other kinds of tests?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#kunit-isn-t-working-what-should-i-do">KUnit isn’t working, what should I do?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tips.html">Tips For Writing KUnit Tests</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tips.html#exiting-early-on-failed-expectations">Exiting early on failed expectations</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips.html#allocating-memory">Allocating memory</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips.html#testing-static-functions">Testing static functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips.html#injecting-test-only-code">Injecting test-only code</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips.html#accessing-the-current-test">Accessing the current test</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips.html#failing-the-current-test">Failing the current test</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips.html#customizing-error-messages">Customizing error messages</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="running_tips.html">Tips For Running KUnit Tests</a><ul>
<li class="toctree-l2"><a class="reference internal" href="running_tips.html#using-kunit-py-run-kunit-tool">Using <code class="docutils literal notranslate"><span class="pre">kunit.py</span> <span class="pre">run</span></code> (“kunit tool”)</a></li>
<li class="toctree-l2"><a class="reference internal" href="running_tips.html#running-tests-manually">Running tests manually</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="what-is-kunit">
<h2>What is KUnit?<a class="headerlink" href="#what-is-kunit" title="Permalink to this headline">¶</a></h2>
<p>KUnit is a lightweight unit testing and mocking framework for the Linux kernel.</p>
<p>KUnit is heavily inspired by JUnit, Python’s unittest.mock, and
Googletest/Googlemock for C++. KUnit provides facilities for defining unit test
cases, grouping related test cases into test suites, providing common
infrastructure for running tests, and much more.</p>
<p>KUnit consists of a kernel component, which provides a set of macros for easily
writing unit tests. Tests written against KUnit will run on kernel boot if
built-in, or when loaded if built as a module. These tests write out results to
the kernel log in <a class="reference external" href="https://testanything.org/">TAP</a> format.</p>
<p>To make running these tests (and reading the results) easier, KUnit offers
<a class="reference internal" href="kunit-tool.html"><span class="doc">kunit_tool</span></a>, which builds a <a class="reference external" href="http://user-mode-linux.sourceforge.net">User Mode Linux</a> kernel, runs it, and parses the test
results. This provides a quick way of running KUnit tests during development,
without requiring a virtual machine or separate hardware.</p>
<p>Get started now: Documentation/dev-tools/kunit/start.rst</p>
</div>
<div class="section" id="why-kunit">
<h2>Why KUnit?<a class="headerlink" href="#why-kunit" title="Permalink to this headline">¶</a></h2>
<p>A unit test is supposed to test a single unit of code in isolation, hence the
name. A unit test should be the finest granularity of testing and as such should
allow all possible code paths to be tested in the code under test; this is only
possible if the code under test is very small and does not have any external
dependencies outside of the test’s control like hardware.</p>
<p>KUnit provides a common framework for unit tests within the kernel.</p>
<p>KUnit tests can be run on most architectures, and most tests are architecture
independent. All built-in KUnit tests run on kernel startup.  Alternatively,
KUnit and KUnit tests can be built as modules and tests will run when the test
module is loaded.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>KUnit can also run tests without needing a virtual machine or actual
hardware under User Mode Linux. User Mode Linux is a Linux architecture,
like ARM or x86, which compiles the kernel as a Linux executable. KUnit
can be used with UML either by building with <code class="docutils literal notranslate"><span class="pre">ARCH=um</span></code> (like any other
architecture), or by using <a class="reference internal" href="kunit-tool.html"><span class="doc">kunit_tool</span></a>.</p>
</div>
<p>KUnit is fast. Excluding build time, from invocation to completion KUnit can run
several dozen tests in only 10 to 20 seconds; this might not sound like a big
deal to some people, but having such fast and easy to run tests fundamentally
changes the way you go about testing and even writing code in the first place.
Linus himself said in his <a class="reference external" href="https://gist.github.com/lorn/1272686/revisions#diff-53c65572127855f1b003db4064a94573R874">git talk at Google</a>:</p>
<blockquote>
<div><p>“… a lot of people seem to think that performance is about doing the
same thing, just doing it faster, and that is not true. That is not what
performance is all about. If you can do something really fast, really
well, people will start using it differently.”</p>
</div></blockquote>
<p>In this context Linus was talking about branching and merging,
but this point also applies to testing. If your tests are slow, unreliable, are
difficult to write, and require a special setup or special hardware to run,
then you wait a lot longer to write tests, and you wait a lot longer to run
tests; this means that tests are likely to break, unlikely to test a lot of
things, and are unlikely to be rerun once they pass. If your tests are really
fast, you run them all the time, every time you make a change, and every time
someone sends you some code. Why trust that someone ran all their tests
correctly on every change when you can just run them yourself in less time than
it takes to read their test log?</p>
</div>
<div class="section" id="how-do-i-use-it">
<h2>How do I use it?<a class="headerlink" href="#how-do-i-use-it" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Documentation/dev-tools/kunit/start.rst - for new users of KUnit</p></li>
<li><p>Documentation/dev-tools/kunit/tips.rst - for short examples of best practices</p></li>
<li><p>Documentation/dev-tools/kunit/usage.rst - for a more detailed explanation of KUnit features</p></li>
<li><p>Documentation/dev-tools/kunit/api/index.rst - for the list of KUnit APIs used for testing</p></li>
<li><p>Documentation/dev-tools/kunit/kunit-tool.rst - for more information on the kunit_tool helper script</p></li>
<li><p>Documentation/dev-tools/kunit/faq.rst - for answers to some common questions about KUnit</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="start.html" class="btn btn-neutral float-right" title="Getting Started" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright The kernel development community.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>